<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Easy and simple logging setup for a new python project. Are you tired of searching how to do it and why it doesn't work? this is your place">
<meta name="viewport" content="width=device-width">
<title>Logging in python | Willy's blog</title>
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/index.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<style>
        .highlight pre, .code pre {
            white-space: pre;
        }
        </style>
<style>
        kbd {
            font-family: Consolas, "Lucida Console", monospace;
            display: inline-block;
            border-radius: 3px;
            padding: 0px 4px;
            box-shadow: 1px 1px 1px #777;
            margin: 2px;
            font-size: small;
            vertical-align: text-bottom;
            background: #eee;
            font-weight: 500;
            color: #555;
            cursor: pointer;
            font-variant: small-caps;
            font-weight: 600;

            /* This two work */
            /* letter-spacing: 0.5px; */
            letter-spacing: 1px;


            /* Prevent selection */
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        </style>
<script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script><link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" hreflang="en" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (es)" hreflang="es" href="../../es/rss.xml">
<link rel="canonical" href="https://woile.dev/posts/logging-in-python/">
<!--[if lt IE 9]><script src="../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><script src="https://cdn.counter.dev/script.js" data-id="acc7e853-fadb-4b91-a2f2-801890951f1e" data-utcoffset="1"></script><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/nix.min.js"></script><script>hljs.highlightAll();</script><meta name="author" content="Woile">
<link rel="prev" href="../digesting-make-makefile/" title="Digesting Make and Makefiles" type="text/html">
<link rel="next" href="../web-app-with-template-in-rust/" title="A Rust web app with HTML templates" type="text/html">
<meta property="og:site_name" content="Willy's blog">
<meta property="og:title" content="Logging in python">
<meta property="og:url" content="https://woile.dev/posts/logging-in-python/">
<meta property="og:description" content="Easy and simple logging setup for a new python project. Are you tired of searching how to do it and why it doesn't work? this is your place">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2022-05-11T13:21:55Z">
<meta property="article:tag" content="logging">
<meta property="article:tag" content="python">
<link rel="alternate" hreflang="es" href="../../es/posts/logging-in-python/">
<link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
</head>
<body>
    <input id="dark-mode" type="checkbox"><div class="theme">
        
    <header class="cover"><input id="cool-menu" type="checkbox"><label for="cool-menu" class="cool-menu__label">
        <svg class="cool-menu hover:cool-menu checked:cool-menu" viewbox="0 0 100 100" width="40" height="40" aria-hidden="true"><circle cx="50" cy="50" r="50" fill-opacity="0.5"></circle></svg></label>
    <nav class="menu"><ul>
<li><a class="hover:menu__link" href="../../">üè† Home</a></li>
                <li><a class="hover:menu__link" href="../../blog/">üì∞ Blog</a></li>
                <li><a class="hover:menu__link" href="../../mentoring/">üìó Mentoring</a></li>
                <li><a class="hover:menu__link" href="../../archive.html">üóÑÔ∏è Archives</a></li>
                <li><a class="hover:menu__link" href="../../categories/index.html">üè∑Ô∏è Tags</a></li>
                <li><a class="hover:menu__link" href="../../rss.xml">üõ∞Ô∏è RSS feed</a></li>

        
        
        
        </ul>
<ul>
<li>
                        <span id="toptranslations">
                        <a href="../../es/" class="hover:menu__link" rel="alternate" hreflang="es">Espa√±ol</a>

        </span>

            </li>
            <li>
                <label class="dark-mode-label hover:dark-mode-label" for="dark-mode">
                    <?xml version="1.0" encoding="UTF-8" standalone="no"?><!-- Generator: Gravit.io --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="isolation: isolate;" viewbox="0 0 416 416" width="30px" height="30px"><defs><clippath id="_clipPath_qEPwrMg7OPn6mDBNPkG6Nqc7qffgU4IC"><rect width="416" height="416"></rect></clippath></defs><g clip-path="url(#_clipPath_qEPwrMg7OPn6mDBNPkG6Nqc7qffgU4IC)"><path d=" M 304 88 C 304 57.38 299.49 26.39 288 0 C 364.43 33.27 416 111.32 416 200 C 416 319.29 319.29 416 200 416 C 111.32 416 33.27 364.43 0 288 C 26.39 299.49 57.38 304 88 304 C 207.29 304 304 207.29 304 88 Z "></path></g></svg></label>
            </li>
        </ul></nav><h3 id="brand"><a href="../../" title="Willy's blog" rel="home">
            <span id="blog-title">Willy's blog</span>
        </a></h3>

    <div>

    </div>

    </header><div class="layout">
            <main id="content" class="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h2 class="p-name entry-title header__title" itemprop="headline name"><a href="." class="u-url hover:header__title__link">Logging in python</a></h2>

        <div class="metadata" style="margin-bottom: 3rem;">
            <span class="byline author vcard p-author h-card" style="display: flex;column-gap: 1rem; flex-wrap: wrap;">
                <span class="byline-name fn p-name" itemprop="author">
                        Woile
                </span>
                <span class="dateline">
                    <a class="article__meta__link hover:article__meta__link" href="." rel="bookmark">
                    <time class="published dt-published" datetime="2022-05-11T13:21:55Z" itemprop="datePublished" title="2022-05-11 13:21">2022-05-11 13:21</time></a>
                </span>
                        <span class="sourceline"><a class="article__meta__link hover:article__meta__link" href="index.md">Source</a></span>

            </span>
            <br><span style="display: flex;column-gap: 1rem; flex-wrap: wrap;">
                <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/logging/" rel="tag">#logging</a>
                <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/python/" rel="tag">#python</a>
            </span>

                <span class="commentline">

        </span>
</div>
        
    </header><section class="e-content entry-content" itemprop="articleBody text"><p>For future reference, this is my logging configuration for a new project.</p>
<p>It is not intended for libraries which already have some kind of set up in place, like django.</p>
<h3>Simple logging configuration</h3>
<p>This is a good configuration to start logging right away.
You can use it when you have a single file, or you can share the <code>logger</code> if stored in a separated file,
which is not recommended when you start growing.</p>
<pre class="highlight"><code class="language-python">import logging
import os
import sys

LOGLEVEL = os.environ.get('LOGLEVEL', 'INFO').upper()
logger = logging.getLogger("my_app")
logger.setLevel(LOGLEVEL)
console_handler = logging.StreamHandler(sys.stdout)
formatter = logging.Formatter("[%(asctime)s] %(name)s:%(lineno)d %(levelname)s :: %(message)s")
console_handler.setFormatter(formatter)
console_handler.setLevel(LOGLEVEL)
logger.addHandler(console_handler)

# Send messages
logger.debug("Set LOGLEVEL=DEBUG to see this")
logger.info("An info log")</code></pre>
<p>You can also replace <code>name</code> with <code>pathname</code> to get the full path.</p>
<h3>Project-wide logging configuration</h3>
<p>In this case we want to configure the logs once, by using the popular dict logging conf:</p>
<pre class="highlight"><code class="language-python"># ./my_app/logs.py
LOGGING_CONFIG = {
    "version": 1,
    "disable_existing_loggers": True,
    "formatters": {
        "standard": {
            "format": "[%(asctime)s] %(name)s:%(lineno)d %(levelname)s :: %(message)s"
        },
    },
    "handlers": {
        "default": {
            "level": "INFO",
            "formatter": "standard",
            "class": "logging.StreamHandler",
            "stream": "ext://sys.stdout",  # Default is stderr
        },
    },
    "loggers": {
        "": {  # root logger
            "handlers": ["default"],
            "level": "WARNING",
            "propagate": False,
        },
        "__main__": {  # if __name__ == '__main__'
            "handlers": ["default"],
            "level": "DEBUG",
            "propagate": False,
        },
        "my_app": {  # folder
            "handlers": ["default"],
            "level": "INFO",
            "propagate": False
        },
    },
}

import logging.config

def init():
    # Run once at startup:
    logging.config.dictConfig(LOGGING_CONFIG)</code></pre>
<pre class="highlight"><code class="language-python"># ./my_app/foo.py
import logs

logs.init()
logger = logging.getLogger(__name__)

# Send messages
logger.debug("Set LOGLEVEL=DEBUG to see this")
logger.info("Hello world")</code></pre>
<p>And your folder structure should look something like:</p>
<pre class="highlight"><code class="language-sh">my-app/
‚îî‚îÄ‚îÄ my_app/
    ‚îú‚îÄ‚îÄ foo.py
    ‚îî‚îÄ‚îÄ logs.py</code></pre>
<h3>Structured logging</h3>
<p>Structured logs are usually in JSON format, making it easy for machines to parse and index them. See for example <a href="https://www.elastic.co/blog/structured-logging-filebeat">structured logging with filebeat</a>.
A common format is bunyan, based on <a href="https://github.com/trentm/node-bunyan">bunyan-node</a>.</p>
<pre class="highlight"><code>pip install bunyan</code></pre>
<pre class="highlight"><code class="language-python">import logging
import bunyan
import sys

logger = logging.getLogger("my_app")
logger.setLevel(logging.INFO)
console_handler = logging.StreamHandler(sys.stdout)
formatter = bunyan.BunyanFormatter()
console_handler.setFormatter(formatter)
console_handler.setLevel(logging.INFO)
logger.addHandler(console_handler)

# Send messages
logger.debug("Set LOGLEVEL=DEBUG to see this")
logger.info("Hello world")</code></pre>
<p>The output of this script would only show the <code>info</code> logger, and it would look like this:</p>
<pre class="highlight"><code class="language-json">{"name": "my_app", "msg": "Hello world", "time": "2022-06-21T07:41:06Z", "hostname": "&lt;REDACTED&gt;", "level": 30, "pid": 40625, "v": 0}</code></pre>
<p>For local development, pipe the logs to the buyan cli, so they become friendly for developers.</p>
<pre class="highlight"><code class="language-sh">wget -c https://github.com/LukeMathWalker/bunyan/releases/download/v0.1.7/bunyan-v0.1.7-x86_64-unknown-linux-gnu.tar.gz -O - | tar -xz

python my_app.py | ./bunyan</code></pre>
<h3>Docker issues</h3>
<p>Sometimes the logs are not sent to the terminal right away, specially if something is blocking. To prevent this, send right away the output to the terminal by setting the env <code>PYTHONUNBUFFERED=1</code>.</p>
<h4>Dockerfile</h4>
<p>Include this line</p>
<pre class="highlight"><code class="language-dockerfile">ENV PYTHONUNBUFFERED 1</code></pre>
<h3>Running docker</h3>
<pre class="highlight"><code class="language-sh">docker run --env "PYTHONUNBUFFERED=1" python:slim bash</code></pre>
<h3>Docker-compose</h3>
<pre class="highlight"><code class="language-yaml">version: '3'
services:
  my_app:
    # ...
    environment:
      - PYTHONUNBUFFERED=1</code></pre>
    </section><aside class="postpromonav"><nav><ul itemprop="keywords" class="tags article__meta">
<li>
            <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/logging/" rel="tag">#logging</a>
          </li>
          <li>
            <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/python/" rel="tag">#python</a>
          </li>
        </ul>
<ul class="pager hidden-print pagination">
<li class="next">
                <a class="hover:pagination__link" href="../web-app-with-template-in-rust/" rel="next" title="A Rust web app with HTML templates">Next post</a>
            </li>
            <li class="previous">
                <a class="hover:pagination__link" href="../digesting-make-makefile/" rel="prev" title="Digesting Make and Makefiles">Previous post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script><div id="comment-section"></div>
<script>
initComments({
  node: document.getElementById("comment-section"),
  defaultHomeserverUrl: "https://matrix.cactus.chat:8448",
  serverName: "cactus.chat",
  siteName: "woile.dev",
  commentSectionId: "logging.in.python"
})
</script></section></article></main>
</div>
    </div>
                <script src="../../assets/js/index.js"></script><script src="../../assets/js/mermaid.min.js"></script><script src="../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
