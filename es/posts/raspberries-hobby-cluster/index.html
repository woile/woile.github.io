<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="es">
<head>
<meta charset="utf-8">
<meta name="description" content="set up a kubernetes cluster with raspberry pi">
<meta name="viewport" content="width=device-width">
<title>Raspberry Pi hobby cluster | Willy's blog</title>
<link href="../../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/index.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (es)" hreflang="es" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://woile.dev/es/posts/raspberries-hobby-cluster/">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><script>
    if(!sessionStorage.getItem("_swa")&&document.referrer.indexOf(location.protocol+"//"+location.host)!== 0){fetch("https://counter.dev/track?"+new URLSearchParams({referrer:document.referrer,screen:screen.width+"x"+screen.height,user:"Woile",utcoffset:"-3"}))};sessionStorage.setItem("_swa","1");
</script><meta name="author" content="Woile">
<link rel="prev" href="../moving-from-docker-alpine-to-slim/" title="Moving from docker alpine to slim" type="text/html">
<link rel="next" href="../sharing-team-secrets/" title="Sharing passwords using gopass, git and gpg" type="text/html">
<meta property="og:site_name" content="Willy's blog">
<meta property="og:title" content="Raspberry Pi hobby cluster">
<meta property="og:url" content="https://woile.dev/es/posts/raspberries-hobby-cluster/">
<meta property="og:description" content="set up a kubernetes cluster with raspberry pi">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-02-22T04:46:17-03:00">
<meta property="article:tag" content="cluster">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="kubernetes">
<meta property="article:tag" content="raspberry">
<link rel="alternate" hreflang="en" href="../../../posts/raspberries-hobby-cluster/">
</head>
<body>
    <input id="dark-mode" type="checkbox"><div class="theme">
        
    <header class="cover"><input id="cool-menu" type="checkbox"><label for="cool-menu" class="cool-menu__label">
        <svg class="cool-menu hover:cool-menu checked:cool-menu" viewbox="0 0 100 100" width="40" height="40" aria-hidden="true"><circle cx="50" cy="50" r="50" fill-opacity="0.5"></circle></svg></label>
    <nav class="menu"><ul>
<li><a class="hover:menu__link" href="../../">üè† Inicio</a></li>
                <li><a class="hover:menu__link" href="../../../blog/">üì∞ Blog</a></li>
                <li><a class="hover:menu__link" href="../../mentoring/">üìó Mentoreo</a></li>
                <li><a class="hover:menu__link" href="../../archive.html">üóÑÔ∏è Archivo</a></li>
                <li><a class="hover:menu__link" href="../../categories/index.html">üè∑Ô∏è Tags</a></li>
                <li><a class="hover:menu__link" href="../../../rss.xml">üõ∞Ô∏è RSS feed</a></li>

        
        
        
        </ul>
<ul>
<li>
                        <span id="toptranslations">
                        <a href="../../../" class="hover:menu__link" rel="alternate" hreflang="en">English</a>

        </span>

            </li>
            <li>
                <label class="dark-mode-label hover:dark-mode-label" for="dark-mode">
                    <?xml version="1.0" encoding="UTF-8" standalone="no"?><!-- Generator: Gravit.io --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="isolation: isolate;" viewbox="0 0 416 416" width="30px" height="30px"><defs><clippath id="_clipPath_qEPwrMg7OPn6mDBNPkG6Nqc7qffgU4IC"><rect width="416" height="416"></rect></clippath></defs><g clip-path="url(#_clipPath_qEPwrMg7OPn6mDBNPkG6Nqc7qffgU4IC)"><path d=" M 304 88 C 304 57.38 299.49 26.39 288 0 C 364.43 33.27 416 111.32 416 200 C 416 319.29 319.29 416 200 416 C 111.32 416 33.27 364.43 0 288 C 26.39 299.49 57.38 304 88 304 C 207.29 304 304 207.29 304 88 Z "></path></g></svg></label>
            </li>
        </ul></nav><h3 id="brand"><a href="../../" title="Willy's blog" rel="home">
            <span id="blog-title">Willy's blog</span>
        </a></h3>

    <div>

    </div>

    </header><div class="layout">
            <main id="content" class="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h2 class="p-name entry-title header__title" itemprop="headline name"><a href="." class="u-url hover:header__title__link">Raspberry Pi hobby cluster</a></h2>

        <div class="metadata">
            <span class="byline author vcard p-author h-card">
            <span class="byline-name fn p-name" itemprop="author">
                    Woile
            </span>
            </span>
                | <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/cluster/" rel="tag">#cluster</a>
                | <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/docker/" rel="tag">#docker</a>
                | <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/kubernetes/" rel="tag">#kubernetes</a>
                | <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/raspberry/" rel="tag">#raspberry</a>
            <span class="dateline">
            <a class="article__meta__link hover:article__meta__link" href="." rel="bookmark">
            <time class="published dt-published" datetime="2019-02-22T04:46:17-03:00" itemprop="datePublished" title="2019-02-22 04:46">2019-02-22 04:46</time></a>
            </span>
                <span class="commentline">        


                    | <span class="sourceline"><a class="article__meta__link hover:article__meta__link" href="index.rst">C√≥digo fuente</a></span>

        </span>
</div>
        
    </header><section class="e-content entry-content" itemprop="articleBody text"><div>
<p>In this tutorial we are gonna try to setup a cluster in our home
server built with raspberries.</p>
<p>In another post I'll describe how to configure a Kubernetes cluster in our raspberries.</p>
<p>Kubernetes is a container orchestration tool, it can do all of this:</p>
<ul class="simple">
<li><p>Automatic bin packing</p></li>
<li><p>Self-healing</p></li>
<li><p>Horizontal scaling</p></li>
<li><p>Service discovery and Load balancing</p></li>
<li><p>Automated rollouts and rollbacks</p></li>
<li><p>Secrets and configuration management</p></li>
<li><p>Storage orchestration</p></li>
<li><p>Long running jobs</p></li>
<li><p>Batch execution</p></li>
</ul>
<!-- TEASER_END --><section id="hardware"><h2>Hardware</h2>
<ul class="simple">
<li><p>4x <a class="reference external" href="https://www.amazon.de/gp/product/B07BDR5PDW/ref=oh_aui_detailpage_o04_s01?ie=UTF8&amp;psc=1">Raspberry Pi 3 B+</a></p></li>
<li><p>4x <a class="reference external" href="https://www.amazon.de/gp/product/B01AWK81VM/ref=oh_aui_detailpage_o04_s03?ie=UTF8&amp;psc=1">RJ45 Cat6 ethernet cable</a></p></li>
<li><p>4x <a class="reference external" href="https://www.amazon.de/gp/product/B06XFSZGCC/ref=oh_aui_detailpage_o04_s02?ie=UTF8&amp;psc=1">32GB Micro SDHC</a></p></li>
<li><p>4x <a class="reference external" href="https://www.amazon.de/gp/product/B016BEVNK4/ref=oh_aui_detailpage_o02_s00?ie=UTF8&amp;psc=1">Micro USB cable</a></p></li>
<li><p>1x <a class="reference external" href="https://www.amazon.de/gp/product/B000FNFSPY/ref=oh_aui_detailpage_o04_s03?ie=UTF8&amp;psc=1">Switch TP-LINK TL-SF1005D 5-Port 10/100Mbps Unmanaged Desktop</a></p></li>
<li><p>1x <a class="reference external" href="https://www.amazon.de/gp/product/B00VUGOSWY/ref=oh_aui_detailpage_o04_s04?ie=UTF8&amp;psc=1">Anker Port Wall Chargers</a></p></li>
<li><p>1x <a class="reference external" href="https://www.amazon.de/DELOCK-Kabel-USB-Power-Hohlstecker/dp/B001XM49Y2/ref=sr_1_7?s=computers&amp;ie=UTF8&amp;qid=1540141485&amp;sr=1-7&amp;keywords=usb+to+barrel">USB to barrel</a> (optional)</p></li>
</ul></section><section id="requirements"><h2>Requirements</h2>
<ul class="simple">
<li><p>unix system (linux or mac)</p></li>
<li><p>flash v2.2.0 <a class="reference external" href="https://github.com/hypriot/flash/tree/2.2.0#installation">installation</a></p></li>
<li><p>hypriot OS v1.9.0 <a class="reference external" href="https://github.com/hypriot/image-builder-rpi/releases/download/v1.9.0/hypriotos-rpi-v1.9.0.img.zip">download</a></p></li>
</ul></section><section id="ssh-keys"><h2>SSH keys</h2>
<p>We need a SSH key in order to connect to the cluster without having to type
the password every time we access.</p>
<p>In case you don't have any, run this command and follow the steps.</p>
<pre class="code bash"><a id="rest_code_46a91af06f8e454797184005bbdee196-1" name="rest_code_46a91af06f8e454797184005bbdee196-1"></a>ssh-keygen -t rsa -b <span class="m">4096</span> -C <span class="s2">"your_email@example.com"</span>
</pre>
<p>Add the key to your ssh agent, assuming our keys generated are <code>id_rsa</code>
and <code>id_rsa.pub</code>.</p>
<pre class="code bash"><a id="rest_code_41fa28a63c444050a9c27293a753ce9c-1" name="rest_code_41fa28a63c444050a9c27293a753ce9c-1"></a>ssh-add ~/.ssh/id_rsa
</pre>
<p>You can find a more in depth explanation in this <a class="reference external" href="https://confluence.atlassian.com/bitbucketserver/creating-ssh-keys-776639788.html">tutorial</a></p>
</section><section id="creating-cloud-init-config"><h2>Creating cloud-init-config</h2>
<p>The <code class="docutils literal">flash</code> command line utility, uses a cloud-init-conf in order to configure the
debian system that it's going to be installed. We are gonna use hypriot debian,
which is optimized for containers.</p>
<p>Let's generate the conf using a template I've created, remember to update
the environment variables with your values.</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead><tr>
<th class="head"><p>Variable</p></th>
<th class="head"><p>Description</p></th>
</tr></thead>
<tbody>
<tr>
<td><p><code class="docutils literal">USERNAME</code></p></td>
<td><p>Username to login into the os</p></td>
</tr>
<tr>
<td><p><code class="docutils literal">SSH_PUBLIC_KEY</code></p></td>
<td><p>A public key to log in without
typing the password.</p></td>
</tr>
<tr>
<td><p><code class="docutils literal">WIFI_SSID_NAME</code></p></td>
<td><p>The name of your wifi</p></td>
</tr>
<tr>
<td><p><code class="docutils literal">WIFI_PASSWORD</code></p></td>
<td><p>Use
<code class="docutils literal">wpa_passphrase SSID PASSWORD</code>
for preshared key</p></td>
</tr>
</tbody>
</table>
<pre class="code bash"><a id="rest_code_db7000fd52db4738ac31c976aaccf070-1" name="rest_code_db7000fd52db4738ac31c976aaccf070-1"></a><span class="nb">export</span> <span class="nv">USERNAME</span><span class="o">=</span>willy
<a id="rest_code_db7000fd52db4738ac31c976aaccf070-2" name="rest_code_db7000fd52db4738ac31c976aaccf070-2"></a><span class="nb">export</span> <span class="nv">WIFI_SSID_NAME</span><span class="o">=</span><span class="s2">"Bla bla"</span>
<a id="rest_code_db7000fd52db4738ac31c976aaccf070-3" name="rest_code_db7000fd52db4738ac31c976aaccf070-3"></a><span class="nb">export</span> <span class="nv">WIFI_PASSWORD</span><span class="o">=</span><span class="s2">"longandsecurepassword"</span>
<a id="rest_code_db7000fd52db4738ac31c976aaccf070-4" name="rest_code_db7000fd52db4738ac31c976aaccf070-4"></a><span class="nb">export</span> <span class="nv">WIFI_COUNTRY</span><span class="o">=</span>NL
<a id="rest_code_db7000fd52db4738ac31c976aaccf070-5" name="rest_code_db7000fd52db4738ac31c976aaccf070-5"></a><span class="nb">export</span> <span class="nv">TIMEZONE</span><span class="o">=</span><span class="k">$(</span>curl -s https://ipapi.co/timezone<span class="k">)</span>
<a id="rest_code_db7000fd52db4738ac31c976aaccf070-6" name="rest_code_db7000fd52db4738ac31c976aaccf070-6"></a><span class="nb">export</span> <span class="nv">SSH_PUBLIC_KEY</span><span class="o">=</span><span class="k">$(</span>cat ~/.ssh/id_rsa.pub<span class="k">)</span>
<a id="rest_code_db7000fd52db4738ac31c976aaccf070-7" name="rest_code_db7000fd52db4738ac31c976aaccf070-7"></a>
<a id="rest_code_db7000fd52db4738ac31c976aaccf070-8" name="rest_code_db7000fd52db4738ac31c976aaccf070-8"></a>curl -s https://gist.githubusercontent.com/Woile/51eca58047b6bd51c60eeae80d60ec14/raw/db05664b5e90a28472f139bc8757562c2ed13026/cloud-init-config-template.yaml <span class="p">|</span> <span class="se">\</span>
<a id="rest_code_db7000fd52db4738ac31c976aaccf070-9" name="rest_code_db7000fd52db4738ac31c976aaccf070-9"></a>sed -e <span class="s2">"s/\${USERNAME}/</span><span class="nv">$USERNAME</span><span class="s2">/"</span> <span class="se">\</span>
<a id="rest_code_db7000fd52db4738ac31c976aaccf070-10" name="rest_code_db7000fd52db4738ac31c976aaccf070-10"></a>-e <span class="s2">"s/\${WIFI_SSID_NAME}/</span><span class="nv">$WIFI_SSID_NAME</span><span class="s2">/"</span> <span class="se">\</span>
<a id="rest_code_db7000fd52db4738ac31c976aaccf070-11" name="rest_code_db7000fd52db4738ac31c976aaccf070-11"></a>-e <span class="s2">"s/\${WIFI_PASSWORD}/</span><span class="nv">$WIFI_PASSWORD</span><span class="s2">/"</span> <span class="se">\</span>
<a id="rest_code_db7000fd52db4738ac31c976aaccf070-12" name="rest_code_db7000fd52db4738ac31c976aaccf070-12"></a>-e <span class="s2">"s/\${WIFI_COUNTRY}/</span><span class="nv">$WIFI_COUNTRY</span><span class="s2">/"</span> <span class="se">\</span>
<a id="rest_code_db7000fd52db4738ac31c976aaccf070-13" name="rest_code_db7000fd52db4738ac31c976aaccf070-13"></a>-e <span class="s2">"s|\${TIMEZONE}|</span><span class="nv">$TIMEZONE</span><span class="s2">|"</span> <span class="se">\</span>
<a id="rest_code_db7000fd52db4738ac31c976aaccf070-14" name="rest_code_db7000fd52db4738ac31c976aaccf070-14"></a>-e <span class="s2">"s|\${SSH_PUBLIC_KEY}|</span><span class="nv">$SSH_PUBLIC_KEY</span><span class="s2">|"</span> &gt; cloud-init-config.yaml
</pre></section><section id="flashing-sd-cards"><h2>Flashing SD cards</h2>
<p>Insert the SD card and find it with <code class="docutils literal">df</code>.</p>
<p>Flash the <code class="docutils literal"><span class="pre">cloud-init-conf.yaml</span></code> in all of your SD cards.
It's important to change the hostname per raspberry. Pay attention to param
<code class="docutils literal"><span class="pre">--hostname</span></code>.</p>
<p>For my 4 raspberries I am going to use these hostnames:</p>
<pre class="code bash"><a id="rest_code_7844836174184b0b8065c09de5a9c055-1" name="rest_code_7844836174184b0b8065c09de5a9c055-1"></a>willy-1
<a id="rest_code_7844836174184b0b8065c09de5a9c055-2" name="rest_code_7844836174184b0b8065c09de5a9c055-2"></a>willy-2
<a id="rest_code_7844836174184b0b8065c09de5a9c055-3" name="rest_code_7844836174184b0b8065c09de5a9c055-3"></a>willy-3
<a id="rest_code_7844836174184b0b8065c09de5a9c055-4" name="rest_code_7844836174184b0b8065c09de5a9c055-4"></a>willy-4
</pre>
<p><code class="docutils literal">flash <span class="pre">-f</span> <span class="pre">--hostname</span> <span class="pre">willy-1</span> <span class="pre">--device</span> &lt;device_found_using_df&gt; <span class="pre">-u</span> <span class="pre">cloud-init-config.yaml</span> <span class="pre">hypriotos-rpi-v1.9.0.img</span> pv</code></p>
<p>Example:</p>
<p><code class="docutils literal">flash <span class="pre">-f</span> <span class="pre">--hostname</span> <span class="pre">willy-1</span> <span class="pre">--device</span> /dev/mmcblk0 <span class="pre">-u</span> <span class="pre">cloud-init-config.yaml</span> <span class="pre">hypriotos-rpi-v1.9.0.img</span> pv</code></p>
<p>Plug the SD card on each raspberry and connect them to the wall.</p>
</section><section id="setting-up-the-nodes"><h2>Setting up the nodes</h2>
<p>To find the IPs of your raspberries run:</p>
<pre class="code bash"><a id="rest_code_3a29e5795ab2403fa354f5260db0d46c-1" name="rest_code_3a29e5795ab2403fa354f5260db0d46c-1"></a><span class="c1"># For Debian based OS</span>
<a id="rest_code_3a29e5795ab2403fa354f5260db0d46c-2" name="rest_code_3a29e5795ab2403fa354f5260db0d46c-2"></a>sudo apt-get install arp-scan
<a id="rest_code_3a29e5795ab2403fa354f5260db0d46c-3" name="rest_code_3a29e5795ab2403fa354f5260db0d46c-3"></a><span class="c1"># For Mac</span>
<a id="rest_code_3a29e5795ab2403fa354f5260db0d46c-4" name="rest_code_3a29e5795ab2403fa354f5260db0d46c-4"></a>brew install arp-scan
</pre>
<pre class="code bash"><a id="rest_code_0a562e7667f24e4fa8be36f3166d751e-1" name="rest_code_0a562e7667f24e4fa8be36f3166d751e-1"></a>ip a  <span class="c1"># here found the interface, like wlp2s0</span>
<a id="rest_code_0a562e7667f24e4fa8be36f3166d751e-2" name="rest_code_0a562e7667f24e4fa8be36f3166d751e-2"></a>sudo arp-scan --interface<span class="o">=</span>&lt;your_interface&gt; --localnet
</pre>
<p>Connect to each one of them using <code class="docutils literal">ssh <span class="pre">&lt;username&gt;@&lt;hostname&gt;</span></code>, because
we previosuly added the ssh key, we should not need to type a passsword.</p>
<p>Execute on each node the next steps.</p>
<section id="reset-password"><h3>Reset password</h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is an important step!</p>
</div>
<p>Update your user‚Äôs password with <code class="docutils literal">passwd</code>. Remember that by default is <code class="docutils literal">hypriot</code>.</p>
</section><section id="configure-firewall"><h3>Configure Firewall</h3>
<p>For simplicity and in case you want to have a multi master cluster, we
are gonna allow ports for master kubernetes and for kubernetes workers.</p>
<p>Run this as root typing <code class="docutils literal">sudo su</code></p>
<pre class="code bash"><a id="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-1" name="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-1"></a>ufw --force reset  <span class="c1"># ok</span>
<a id="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-2" name="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-2"></a>ufw allow ssh
<a id="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-3" name="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-3"></a>ufw allow <span class="m">6443</span> <span class="c1"># Kubernetes API (master)</span>
<a id="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-4" name="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-4"></a>ufw allow <span class="m">80</span>  <span class="c1"># HTTP</span>
<a id="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-5" name="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-5"></a>ufw allow <span class="m">443</span>  <span class="c1"># HTTPS</span>
<a id="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-6" name="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-6"></a>ufw allow <span class="m">8443</span>  <span class="c1"># kubectl proxy</span>
<a id="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-7" name="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-7"></a>ufw allow <span class="m">10250</span>  <span class="c1"># Kubelet API (master and worker)</span>
<a id="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-8" name="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-8"></a>ufw allow <span class="m">10251</span>  <span class="c1"># kube-scheduler (master)</span>
<a id="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-9" name="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-9"></a>ufw allow <span class="m">10252</span>  <span class="c1"># kube-controller-manager (master)</span>
<a id="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-10" name="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-10"></a>ufw allow <span class="m">2379</span>:2380/tcp  <span class="c1"># etcd server client API (master)</span>
<a id="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-11" name="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-11"></a>ufw allow <span class="m">30000</span>:32767/tcp  <span class="c1"># NodePort Services** (worker)</span>
<a id="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-12" name="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-12"></a>ufw default deny incoming
<a id="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-13" name="rest_code_7e5ad81defb24ffe9e3792ce7de1f23f-13"></a>yes <span class="p">|</span> ufw <span class="nb">enable</span>
</pre>
<p><a class="reference external" href="https://kubernetes.io/docs/setup/independent/install-kubeadm/#check-required-ports">Ports used by kubernetes</a></p>
</section></section><section id="configuring-master-node"><h2>Configuring master node</h2>
<p>Choose one of the raspberries as the master, I use <code class="docutils literal"><span class="pre">willy-1</span></code> as
master.</p>
<section id="set-static-ip"><h3>Set static IP</h3>
<p>Edit <code class="docutils literal">/etc/network/interfaces.d/eth0</code> and set it to</p>
<pre class="code ini"><a id="rest_code_028a1f0b87b540cda1d55a14d53e9dec-1" name="rest_code_028a1f0b87b540cda1d55a14d53e9dec-1"></a><span class="na">allow-hotplug eth0</span>
<a id="rest_code_028a1f0b87b540cda1d55a14d53e9dec-2" name="rest_code_028a1f0b87b540cda1d55a14d53e9dec-2"></a><span class="na">iface eth0 inet static</span>
<a id="rest_code_028a1f0b87b540cda1d55a14d53e9dec-3" name="rest_code_028a1f0b87b540cda1d55a14d53e9dec-3"></a><span class="na">address 10.0.0.1</span>
<a id="rest_code_028a1f0b87b540cda1d55a14d53e9dec-4" name="rest_code_028a1f0b87b540cda1d55a14d53e9dec-4"></a><span class="na">netmask 255.255.255.0</span>
<a id="rest_code_028a1f0b87b540cda1d55a14d53e9dec-5" name="rest_code_028a1f0b87b540cda1d55a14d53e9dec-5"></a><span class="na">broadcast 10.0.0.255</span>
<a id="rest_code_028a1f0b87b540cda1d55a14d53e9dec-6" name="rest_code_028a1f0b87b540cda1d55a14d53e9dec-6"></a><span class="na">gateway 10.0.0.1</span>
</pre>
<p>Reboot to claim the IP <code class="docutils literal">10.0.0.1</code> in your internal cluster‚Äôs network
(the switch network)</p>
</section><section id="allocate-addresses-to-the-worker-nodes-using-dhcp"><h3>Allocate addresses to the worker nodes using DHCP</h3>
<p>The cloud-init template already includes <code class="docutils literal"><span class="pre">isc-dhcp-server</span></code></p>
<p>Edit <code class="docutils literal"><span class="pre">/etc/default/isc-dhcp-server</span></code>, comment out <code class="docutils literal"># <span class="pre">INTERFACESv6=""</span></code>
and set <code class="docutils literal"><span class="pre">INTERFACESv4="eth0"</span></code></p>
<p>Or run this</p>
<pre class="code bash"><a id="rest_code_5bbcb73cc38e4da2a003d89ed805ef0a-1" name="rest_code_5bbcb73cc38e4da2a003d89ed805ef0a-1"></a>sudo sed -e <span class="s1">'/INTERFACESv6=/ s/^#*/#/'</span> -e <span class="s1">'s/INTERFACESv4=""/INTERFACESv4="eth0"/g'</span> -i /etc/default/isc-dhcp-server
</pre>
<p>Backup and edit <code class="docutils literal">/etc/dhcp/dhcpd.conf</code>. Set it like this:</p>
<pre class="code ini"><a id="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-1" name="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-1"></a><span class="na">option domain-name "willy.home"; # Set a domain name, can be anything</span>
<a id="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-2" name="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-2"></a><span class="na">option domain-name-servers 8.8.8.8, 8.8.4.4; # Use Google DNS by default, you can substitute ISP-supplied values here</span>
<a id="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-3" name="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-3"></a><span class="na">subnet 10.0.0.0 netmask 255.255.255.0 { # We'll use 10.0.0.X for our subnet</span>
<a id="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-4" name="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-4"></a>    <span class="na">range 10.0.0.1 10.0.0.50;</span>
<a id="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-5" name="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-5"></a>    <span class="na">option subnet-mask 255.255.255.0;</span>
<a id="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-6" name="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-6"></a>    <span class="na">option broadcast-address 10.0.0.255;</span>
<a id="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-7" name="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-7"></a>    <span class="na">option routers 10.0.0.1;</span>
<a id="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-8" name="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-8"></a><span class="na">}</span>
<a id="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-9" name="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-9"></a><span class="na">default-lease-time 600;</span>
<a id="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-10" name="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-10"></a><span class="na">max-lease-time 7200;</span>
<a id="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-11" name="rest_code_c72cfcf497334b1eacd529d2ddbfa1ca-11"></a><span class="na">authoritative;</span>
</pre>
<p>Restart service <code class="docutils literal">sudo systemctl restart dhcpcd.service</code></p>
<p>Now our master will start assigning addresses to the other nodes.</p>
<p>In case it‚Äôs not assigning IPs, try unplugging from the switch and
restarting all the other nodes but the master. You can check the IPs by
doing <code class="docutils literal">ip a</code> or <code class="docutils literal">hostname <span class="pre">-I</span></code>, remember that this is the range
<code class="docutils literal">range 10.0.0.1 10.0.0.50</code></p>
<p>Our cluster is set up now.</p>
</section></section><section id="credits"><h2>Credits</h2>
<p>This tutorial is based on <a class="reference external" href="http://shop.oreilly.com/product/0636920043874.do">Kubernetes: Up and Running</a>, <a class="reference external" href="https://blog.hypriot.com/post/setup-kubernetes-raspberry-pi-cluster/">Hypriot |
Setup Kubernetes on a Raspberry Pi Cluster easily the official way!</a> and
<a class="reference external" href="https://imti.co/hobby-cluster/#swap">Production Hobby Cluster</a>.</p>
</section>
</div>
    </section><aside class="postpromonav"><nav><ul itemprop="keywords" class="tags article__meta">
<li>
            <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/cluster/" rel="tag">#cluster</a>
          </li>
          <li>
            <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/docker/" rel="tag">#docker</a>
          </li>
          <li>
            <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/kubernetes/" rel="tag">#kubernetes</a>
          </li>
          <li>
            <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/raspberry/" rel="tag">#raspberry</a>
          </li>
        </ul>
<ul class="pager hidden-print pagination">
<li class="previous">
                <a class="hover:pagination__link" href="../moving-from-docker-alpine-to-slim/" rel="prev" title="Moving from docker alpine to slim">Publicaci√≥n anterior</a>
            </li>
            <li class="next">
                <a class="hover:pagination__link" href="../sharing-team-secrets/" rel="next" title="Sharing passwords using gopass, git and gpg">Siguiente publicaci√≥n</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><div class="commentbox" id="commentbox"></div>

        <script src="https://unpkg.com/commentbox.io/dist/commentBox.min.js"></script><script>

        commentBox('5692121306628096-proj');
        </script><noscript>Please enable JavaScript to view the comments</noscript>


        </section></article></main>
</div>
    </div>
                <script src="../../../assets/js/index.js"></script><script src="../../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
