<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="es">
<head>
<meta charset="utf-8">
<meta name="description" content="Easy and simple logging setup for a new python project. Are you tired of searching how to do it and why it doesn't work? this is your place">
<meta name="viewport" content="width=device-width">
<title>Logging in python | Willy's blog</title>
<link href="../../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/index.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<style>
        .highlight pre, .code pre {
            white-space: pre;
        }
        </style>
<script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script><link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (es)" hreflang="es" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://woile.dev/es/posts/logging-in-python/">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><script>
    if(!sessionStorage.getItem("_swa")&&document.referrer.indexOf(location.protocol+"//"+location.host)!== 0){ fetch("https://counter.dev/track?"+new URLSearchParams({ referrer:document.referrer,screen:screen.width+"x"+screen.height,user:"Woile",utcoffset:"1"}), { referrerPolicy: "no-referrer-when-downgrade"})};sessionStorage.setItem("_swa","1");
</script><meta name="author" content="Woile">
<link rel="prev" href="../digesting-make-makefile/" title="Digesting Make and Makefiles" type="text/html">
<meta property="og:site_name" content="Willy's blog">
<meta property="og:title" content="Logging in python">
<meta property="og:url" content="https://woile.dev/es/posts/logging-in-python/">
<meta property="og:description" content="Easy and simple logging setup for a new python project. Are you tired of searching how to do it and why it doesn't work? this is your place">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2022-05-11T13:21:55Z">
<meta property="article:tag" content="logging">
<meta property="article:tag" content="python">
<link rel="alternate" hreflang="en" href="../../../posts/logging-in-python/">
<link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
</head>
<body>
    <input id="dark-mode" type="checkbox"><div class="theme">
        
    <header class="cover"><input id="cool-menu" type="checkbox"><label for="cool-menu" class="cool-menu__label">
        <svg class="cool-menu hover:cool-menu checked:cool-menu" viewbox="0 0 100 100" width="40" height="40" aria-hidden="true"><circle cx="50" cy="50" r="50" fill-opacity="0.5"></circle></svg></label>
    <nav class="menu"><ul>
<li><a class="hover:menu__link" href="../../">üè† Inicio</a></li>
                <li><a class="hover:menu__link" href="../../../blog/">üì∞ Blog</a></li>
                <li><a class="hover:menu__link" href="../../mentoring/">üìó Mentoreo</a></li>
                <li><a class="hover:menu__link" href="../../archive.html">üóÑÔ∏è Archivo</a></li>
                <li><a class="hover:menu__link" href="../../categories/index.html">üè∑Ô∏è Tags</a></li>
                <li><a class="hover:menu__link" href="../../../rss.xml">üõ∞Ô∏è RSS feed</a></li>

        
        
        
        </ul>
<ul>
<li>
                        <span id="toptranslations">
                        <a href="../../../" class="hover:menu__link" rel="alternate" hreflang="en">English</a>

        </span>

            </li>
            <li>
                <label class="dark-mode-label hover:dark-mode-label" for="dark-mode">
                    <?xml version="1.0" encoding="UTF-8" standalone="no"?><!-- Generator: Gravit.io --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="isolation: isolate;" viewbox="0 0 416 416" width="30px" height="30px"><defs><clippath id="_clipPath_qEPwrMg7OPn6mDBNPkG6Nqc7qffgU4IC"><rect width="416" height="416"></rect></clippath></defs><g clip-path="url(#_clipPath_qEPwrMg7OPn6mDBNPkG6Nqc7qffgU4IC)"><path d=" M 304 88 C 304 57.38 299.49 26.39 288 0 C 364.43 33.27 416 111.32 416 200 C 416 319.29 319.29 416 200 416 C 111.32 416 33.27 364.43 0 288 C 26.39 299.49 57.38 304 88 304 C 207.29 304 304 207.29 304 88 Z "></path></g></svg></label>
            </li>
        </ul></nav><h3 id="brand"><a href="../../" title="Willy's blog" rel="home">
            <span id="blog-title">Willy's blog</span>
        </a></h3>

    <div>

    </div>

    </header><div class="layout">
            <main id="content" class="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h2 class="p-name entry-title header__title" itemprop="headline name"><a href="." class="u-url hover:header__title__link">Logging in python</a></h2>

        <div class="metadata" style="margin-bottom: 3rem;">
            <span class="byline author vcard p-author h-card" style="display: flex;column-gap: 1rem; flex-wrap: wrap;">
                <span class="byline-name fn p-name" itemprop="author">
                        Woile
                </span>
                <span class="dateline">
                    <a class="article__meta__link hover:article__meta__link" href="." rel="bookmark">
                    <time class="published dt-published" datetime="2022-05-11T13:21:55Z" itemprop="datePublished" title="2022-05-11 13:21">2022-05-11 13:21</time></a>
                </span>
                        <span class="sourceline"><a class="article__meta__link hover:article__meta__link" href="index.md">C√≥digo fuente</a></span>

            </span>
            <br><span style="display: flex;column-gap: 1rem; flex-wrap: wrap;">
                <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/logging/" rel="tag">#logging</a>
                <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/python/" rel="tag">#python</a>
            </span>

                <span class="commentline">

        </span>
</div>
        
    </header><section class="e-content entry-content" itemprop="articleBody text"><p>For future reference, this is my logging configuration for a new project.</p>
<p>It is not intended for libraries which already have some kind of set up in place, like django.</p>
<h3>Simple logging configuration</h3>
<p>This is a good configuration to start logging right away.
You can use it when you have a single file, or you can share the <code>logger</code> if stored in a separated file,
which is not recommended when you start growing.</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">LOGLEVEL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'LOGLEVEL'</span><span class="p">,</span> <span class="s1">'INFO'</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">"my_app"</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">LOGLEVEL</span><span class="p">)</span>
<span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s2">"[</span><span class="si">%(asctime)s</span><span class="s2">] </span><span class="si">%(name)s</span><span class="s2">:</span><span class="si">%(lineno)d</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> :: </span><span class="si">%(message)s</span><span class="s2">"</span><span class="p">)</span>
<span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
<span class="n">console_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">LOGLEVEL</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>

<span class="c1"># Send messages</span>
<span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Set LOGLEVEL=DEBUG to see this"</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"An info log"</span><span class="p">)</span>
</pre></div>
<p>You can also replace <code>name</code> with <code>pathname</code> to get the full path.</p>
<h3>Project-wide logging configuration</h3>
<p>In this case we want to configure the logs once, by using the popular dict logging conf:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># ./my_app/logs.py</span>
<span class="n">LOGGING_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"version"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">"disable_existing_loggers"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">"formatters"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"standard"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"format"</span><span class="p">:</span> <span class="s2">"[</span><span class="si">%(asctime)s</span><span class="s2">] </span><span class="si">%(name)s</span><span class="s2">:</span><span class="si">%(lineno)d</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> :: </span><span class="si">%(message)s</span><span class="s2">"</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s2">"handlers"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"default"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"level"</span><span class="p">:</span> <span class="s2">"INFO"</span><span class="p">,</span>
            <span class="s2">"formatter"</span><span class="p">:</span> <span class="s2">"standard"</span><span class="p">,</span>
            <span class="s2">"class"</span><span class="p">:</span> <span class="s2">"logging.StreamHandler"</span><span class="p">,</span>
            <span class="s2">"stream"</span><span class="p">:</span> <span class="s2">"ext://sys.stdout"</span><span class="p">,</span>  <span class="c1"># Default is stderr</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s2">"loggers"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">""</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># root logger</span>
            <span class="s2">"handlers"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"default"</span><span class="p">],</span>
            <span class="s2">"level"</span><span class="p">:</span> <span class="s2">"WARNING"</span><span class="p">,</span>
            <span class="s2">"propagate"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">"__main__"</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># if __name__ == '__main__'</span>
            <span class="s2">"handlers"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"default"</span><span class="p">],</span>
            <span class="s2">"level"</span><span class="p">:</span> <span class="s2">"DEBUG"</span><span class="p">,</span>
            <span class="s2">"propagate"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">"my_app"</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># folder</span>
            <span class="s2">"handlers"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"default"</span><span class="p">],</span>
            <span class="s2">"level"</span><span class="p">:</span> <span class="s2">"INFO"</span><span class="p">,</span>
            <span class="s2">"propagate"</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="kn">import</span> <span class="nn">logging.config</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="c1"># Run once at startup:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dictConfig</span><span class="p">(</span><span class="n">LOGGING_CONFIG</span><span class="p">)</span>
</pre></div>
<div class="code"><pre class="code literal-block"><span class="c1"># ./my_app/foo.py</span>
<span class="kn">import</span> <span class="nn">logs</span>

<span class="n">logs</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Send messages</span>
<span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Set LOGLEVEL=DEBUG to see this"</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Hello world"</span><span class="p">)</span>
</pre></div>
<p>And your folder structure should look something like:</p>
<div class="code"><pre class="code literal-block">my-app/
‚îî‚îÄ‚îÄ my_app/
    ‚îú‚îÄ‚îÄ foo.py
    ‚îî‚îÄ‚îÄ logs.py
</pre></div>
<h3>Structured logging</h3>
<p>Structured logs are usually in JSON format, making it easy for machines to parse and index them. See for example <a href="https://www.elastic.co/blog/structured-logging-filebeat">structured logging with filebeat</a>.
A common format is bunyan, based on <a href="https://github.com/trentm/node-bunyan">bunyan-node</a>.</p>
<div class="code"><pre class="code literal-block">pip install bunyan
</pre></div>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">bunyan</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">"my_app"</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="n">formatter</span> <span class="o">=</span> <span class="n">bunyan</span><span class="o">.</span><span class="n">BunyanFormatter</span><span class="p">()</span>
<span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
<span class="n">console_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>

<span class="c1"># Send messages</span>
<span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Set LOGLEVEL=DEBUG to see this"</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Hello world"</span><span class="p">)</span>
</pre></div>
<p>The output of this script would only show the <code>info</code> logger, and it would look like this:</p>
<div class="code"><pre class="code literal-block"><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my_app"</span><span class="p">,</span><span class="w"> </span><span class="nt">"msg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hello world"</span><span class="p">,</span><span class="w"> </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-06-21T07:41:06Z"</span><span class="p">,</span><span class="w"> </span><span class="nt">"hostname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;REDACTED&gt;"</span><span class="p">,</span><span class="w"> </span><span class="nt">"level"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="nt">"pid"</span><span class="p">:</span><span class="w"> </span><span class="mi">40625</span><span class="p">,</span><span class="w"> </span><span class="nt">"v"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span><span class="w"></span>
</pre></div>
<p>For local development, pipe the logs to the buyan cli, so they become friendly for developers.</p>
<div class="code"><pre class="code literal-block">wget -c https://github.com/LukeMathWalker/bunyan/releases/download/v0.1.7/bunyan-v0.1.7-x86_64-unknown-linux-gnu.tar.gz -O - <span class="p">|</span> tar -xz

python my_app.py <span class="p">|</span> ./bunyan
</pre></div>
<h3>Docker issues</h3>
<p>Sometimes the logs are not sent to the terminal right away, specially if something is blocking. To prevent this, send right away the output to the terminal by setting the env <code>PYTHONUNBUFFERED=1</code>.</p>
<h4>Dockerfile</h4>
<p>Include this line</p>
<div class="code"><pre class="code literal-block"><span class="k">ENV</span><span class="w"> </span>PYTHONUNBUFFERED <span class="m">1</span>
</pre></div>
<h3>Running docker</h3>
<div class="code"><pre class="code literal-block">docker run --env <span class="s2">"PYTHONUNBUFFERED=1"</span> python:slim bash
</pre></div>
<h3>Docker-compose</h3>
<div class="code"><pre class="code literal-block"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">'3'</span><span class="w"></span>
<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">my_app</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># ...</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PYTHONUNBUFFERED=1</span><span class="w"></span>
</pre></div>
    </section><aside class="postpromonav"><nav><ul itemprop="keywords" class="tags article__meta">
<li>
            <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/logging/" rel="tag">#logging</a>
          </li>
          <li>
            <a class="tag p-category article__meta__link hover:article__meta__link" href="../../categories/python/" rel="tag">#python</a>
          </li>
        </ul>
<ul class="pager hidden-print pagination">
<li class="next">
            </li>
            <li class="previous">
                <a class="hover:pagination__link" href="../digesting-make-makefile/" rel="prev" title="Digesting Make and Makefiles">Publicaci√≥n anterior</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script><div id="comment-section"></div>
<script>
initComments({
  node: document.getElementById("comment-section"),
  defaultHomeserverUrl: "https://matrix.cactus.chat:8448",
  serverName: "cactus.chat",
  siteName: "woile.dev",
  commentSectionId: "logging.in.python"
})
</script></section></article></main>
</div>
    </div>
                <script src="../../../assets/js/index.js"></script><script src="../../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
